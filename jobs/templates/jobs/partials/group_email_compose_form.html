{% load widget_tweaks %}
<form hx-post="{% url 'jobs:compose_group_email' group.id %}" hx-target="#offcanvas-content">
    {% csrf_token %}
    <h4>群发邮件至分组: {{ group.name }}</h4>
    <p class="text-muted">收件人数量: {{ recipient_count }}</p>
    <hr>
    
    <div class="mb-3">
        <label for="{{ form.from_account.id_for_label }}" class="form-label">{{ form.from_account.label }}</label>
        {% render_field form.from_account class="form-select" %}
    </div>
    <div class="mb-3">
        <label for="{{ form.subject.id_for_label }}" class="form-label">{{ form.subject.label }}</label>
        {% render_field form.subject class="form-control" required="true" %}
    </div>
    <div class="mb-3">
        <label for="{{ form.content.id_for_label }}" class="form-label">{{ form.content.label }}</label>
        {% render_field form.content class="form-control" required="true" %}
    </div>

    <button type="submit" class="btn btn-primary" {% if recipient_count == 0 or not form.fields.from_account.queryset %}disabled{% endif %}>
        <span class="htmx-indicator spinner-border spinner-border-sm"></span>
        为 {{ recipient_count }} 人加入发送队列
    </button>
    <button type="button" class="btn btn-secondary" data-bs-dismiss="offcanvas">
        取消
    </button>
</form>
